#/bin/sh
# Copyright (C) 2018 Mark D. Blackwell.
#   All rights reserved.
#   This program is distributed in the hope that it will be useful,
#   but WITHOUT ANY WARRANTY; without even the implied warranty of
#   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.

# See:
# https://developers.google.com/speed/docs/insights/MinifyResources
# https://dimiterpetrov.com/blog/elm-single-page-application-setup/
# https://github.com/ben-eb/cssnano-cli
# https://github.com/kangax/html-minifier
# https://github.com/mishoo/UglifyJS2

# Versions:
#  html-minifier 3.5.6
#  cssnano-cli 1.0.5

# Don't uglify (or compress) the PHP program on the server (append.php),
#   since browsers don't download it, and thus it doesn't involve slow
#   network traffic.

(
export PATH=$PATH:./node_modules/.bin && \

cd build && \

DIRECTORY_SOURCE=../src/remember-source && \

NAME=SetUp && \
echo "Minifying $NAME.js to $NAME-min.js" && \
../node_modules/.bin/uglifyjs --compress --mangle --warn -- \
  $DIRECTORY_SOURCE/$NAME.js > \
  $NAME-min.js && \

NAME=RememberSongs-windows-phone-8-viewport-fix && \
echo "Minifying $NAME.js to $NAME-min.js" && \
../node_modules/.bin/uglifyjs --compress --mangle --warn -- \
  $DIRECTORY_SOURCE/$NAME.js > \
  $NAME-min.js && \

NAME=RememberSongs && \
echo "Minifying $NAME-src.html to $NAME.html" && \
../node_modules/.bin/html-minifier --config-file ../html-minifier-conf.json \
  $DIRECTORY_SOURCE/$NAME-src.html > \
  $NAME.html && \

NAME=RememberSongs && \
echo "Minifying $NAME.css to $NAME-min.css" && \
../node_modules/.bin/cssnano \
  $DIRECTORY_SOURCE/$NAME.css > \
  $NAME-min.css && \

NAME=RememberSongs-responsive-smartphone && \
echo "Minifying $NAME.css to $NAME-min.css" && \
../node_modules/.bin/cssnano \
  $DIRECTORY_SOURCE/$NAME.css > \
  $NAME-min.css && \

:) || \

echo "Failed to complete"
