#/bin/sh
# Copyright (C) 2018 Mark D. Blackwell.
#   All rights reserved.
#   This program is distributed in the hope that it will be useful,
#   but WITHOUT ANY WARRANTY; without even the implied warranty of
#   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.

# Versions:
#  node 5.12.0 or 6.11.0
#  npm 3.8.6 or 3.10.10 (comes with node)
#  elm 0.18.0
#  elm-format 0.7.0-exp
#  uglify-js 3.1.7

DIRECTORY_FRONT_END=src/front-end

DIRECTORY_TEMP=tmp

echo "Searching for trailing blanks"
grep -nEI ' $' `find $DIRECTORY_FRONT_END -type f`

(
export PATH=$PATH:./node_modules/.bin && \

for directory_source in `find $DIRECTORY_FRONT_END -type d`
do
  echo "Formatting $directory_source"
  elm-format --yes $directory_source
done && \

NAME=Main && \
elm-make --warn --output=$DIRECTORY_TEMP/$NAME.js $DIRECTORY_FRONT_END/$NAME.elm && \

echo "Minifying $NAME.js to $NAME-min.js" && \
uglifyjs --compress --mangle reserved=['Elm'] -- \
  $DIRECTORY_TEMP/$NAME.js > \
  build/$NAME-min.js && \

:) || \

echo "Failed to complete"
