#/bin/sh
# Copyright (C) 2018 Mark D. Blackwell.
#   All rights reserved.
#   This program is distributed in the hope that it will be useful,
#   but WITHOUT ANY WARRANTY; without even the implied warranty of
#   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.

# Versions:
#  Elm 0.18.0
#  Node.js 5.12.0 or 6.11.0 or 12.16.2 or latest LTS
#  npm 3.8.6 or 3.10.10 or 6.14.4 (comes with Node.js)
#  elm-format 0.7.0-exp or 0.8.3
#  uglify-js 3.1.7 or 3.9.1

DIRECTORY_FRONT_END=src/front-end

DIRECTORY_TEMP=tmp

echo "Searching for trailing blanks"
grep -nEI ' $' `find $DIRECTORY_FRONT_END -type f`

(
export PATH="node_modules/.bin:$PATH" && \

for directory_source in `find $DIRECTORY_FRONT_END -type d`
do
  echo "Formatting $directory_source"
  elm-format --yes $directory_source
done && \

NAME=Main && \
elm-make --warn --output=$DIRECTORY_TEMP/$NAME.js $DIRECTORY_FRONT_END/$NAME.elm && \

echo "Minifying $NAME.js to $NAME-min.js" && \
uglifyjs --compress --mangle reserved=['Elm'] -- \
  $DIRECTORY_TEMP/$NAME.js > \
  build/$NAME-min.js && \

:) || \

echo "Failed to complete"
